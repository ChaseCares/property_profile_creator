<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Create a Listing</title>
		<style>
			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial,
					sans-serif;
				background-color: #f4f4f9;
				color: #333;
				line-height: 1.6;
			}
			.container {
				max-width: 800px;
				margin: 40px auto;
				padding: 20px;
				background-color: #fff;
				border-radius: 8px;
				box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			}
			h1,
			h2 {
				color: #0056b3;
			}
			form {
				display: flex;
				gap: 10px;
				margin-bottom: 20px;
			}
			input[type='text'] {
				flex-grow: 1;
				padding: 10px;
				border: 1px solid #ddd;
				border-radius: 4px;
				font-size: 1rem;
			}
			input[type='submit'] {
				padding: 10px 20px;
				border: none;
				background-color: #007bff;
				color: white;
				border-radius: 4px;
				cursor: pointer;
				font-size: 1rem;
				transition: background-color 0.2s;
			}
			input[type='submit']:hover {
				background-color: #0056b3;
			}
			input[type='submit']:disabled {
				background-color: #ccc;
				cursor: not-allowed;
			}
			pre#logs {
				white-space: pre-wrap;
				word-wrap: break-word;
				background-color: #282c34;
				color: #abb2bf;
				padding: 15px;
				border-radius: 4px;
				min-height: 100px;
				font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>Create a Listing</h1>
			<p>
				Link must be a Compass.com link, e.g.
				<a
					href="https://www.compass.com/listing/1-prestwick-court-holmdel-nj-07733/1115756859878376233"
				>
					https://www.compass.com/listing/ {address}
				</a>
			</p>
			<form id="listing_text">
				<input type="text" name="listing_text" placeholder="Item Name:" required />
				<input type="submit" value="Create" />
			</form>
			<h2>Logs:</h2>
			<pre id="logs"></pre>
		</div>

		<script>
			document.getElementById('listing_text').addEventListener('submit', async function (event) {
				event.preventDefault();

				const form = event.target;
				const formData = new FormData(form);
				const submitButton = form.querySelector('input[type="submit"]');
				const logContainer = document.getElementById('logs');

				logContainer.textContent = 'Connecting to server...';
				submitButton.disabled = true;

				try {
					const response = await fetch('/create', {
						method: 'POST',
						body: new URLSearchParams(formData),
					});

					if (!response.ok) {
						throw new Error(`HTTP error! Status: ${response.status}`);
					}

					const reader = response.body.getReader();
					const decoder = new TextDecoder();
					logContainer.textContent = '';

					while (true) {
						const { done, value } = await reader.read();
						if (done) {
							break;
						}
						const chunk = decoder.decode(value, { stream: true });
						logContainer.textContent += chunk + '\n';
					}
				} catch (error) {
					logContainer.textContent = `Error: ${error.message}`;
					console.error('Fetch error:', error);
				} finally {
					submitButton.disabled = false;
				}
			});
		</script>
	</body>
</html>
